<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTarget="Build">
    <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>
  
    <!-- Application Configurations -->
    <PropertyGroup>
        <NUnit-Path>C:\Program Files (x86)\NUnit 2.5.9\bin\net-2.0</NUnit-Path>
        <Python-Path>C:\python27\python.exe</Python-Path>
        <AsciiDoc-Path>C:\Tools\AsciiDoc\asciidoc.py</AsciiDoc-Path>
    </PropertyGroup>
    
    <!-- Projects and configurations to build -->
    <!-- Debug target is build for running the unit tests -->
    <ItemGroup>
        <ProjectToBuild Include="CheckSumTool.csproj">
            <Properties>Configuration=Debug</Properties>
        </ProjectToBuild>
        <ProjectToBuild Include="CheckSumTool.csproj">
            <Properties>Configuration=Release</Properties>
        </ProjectToBuild>
    </ItemGroup>

    <!-- Clean build folders -->
    <Target Name="Clean">
        <ItemGroup>
            <BinFiles Include="..\Build\Debug\*.*" />
            <BinFiles Include="..\BuildTmp\Debug\*.*" />
            <BinFiles Include="..\Build\Release\*.*" />
            <BinFiles Include="..\BuildTmp\Release\*.*" />
        </ItemGroup>
        <Delete Files="@(BinFiles)" />
    </Target>

    <!-- Build projects -->
    <Target Name="Compile" DependsOnTargets="Clean">
        <MSBuild Projects="@(ProjectToBuild)" />
    </Target>

    <!-- Run NUnit unit tests -->
    <Target Name="Test" DependsOnTargets="Clean;Compile">
        <ItemGroup>
            <TestAssemblies Include="..\Build\Debug\CheckSumTool.exe" />
            <TestAssemblies Include="..\Build\Debug\SumLib.dll" />
            <TestAssemblies Include="..\Build\Debug\Utils.dll" />
        </ItemGroup>

        <NUnit ToolPath="$(NUnit-Path)"  Assemblies="@(TestAssemblies)" OutputXmlFile="test-results.xml" />
    </Target>
    
    <!-- Build user manual with Python and AsciiDoc -->
    <Target Name="Manual">
        <Exec Command="$(Python-Path) $(AsciiDoc-Path) ..\Documents\Manual\Manual.txt"/>
    </Target>

    <Target Name="Build" DependsOnTargets="Clean;Compile;Test;Manual;" />

</Project>
